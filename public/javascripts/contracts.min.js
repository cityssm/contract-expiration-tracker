"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const t=exports.urlPrefix,e={csv:document.querySelector("#export--csv"),ical:document.querySelector("#export--ical")},o=o=>{const c=window.location.protocol+"//"+window.location.host+t+"/export/"+o+"/"+exports.userName+"/"+exports.guidA+"/"+exports.guidB,a=new URL(c);a.searchParams.set("contractCategory",n.value),a.searchParams.set("searchString",document.querySelector("#filters--searchString").value),m.checked&&a.searchParams.set("includeExpired",m.value),e[o].href=a.href},c=()=>{cityssm.postJSON(t+"/contracts/doResetUserAccessGUIDs",{},t=>{t.success&&(bulmaJS.alert({title:"Export Keys Reset Successfully",message:"Note that if your export links are used by any application like Microsoft Excel or Outlook, you will have to update those links."}),exports.guidA=t.guidA,exports.guidB=t.guidB,o("csv"),o("ical"))})};document.querySelector("#navbar--resetUserAccessGUIDs").addEventListener("click",t=>{t.preventDefault(),bulmaJS.confirm({contextualColorName:"warning",title:"Are you sure you want to reset your export keys?",message:"This should definitely be done if you think your export keys have been compromised.",okButton:{text:"Yes, Reset the Keys",callbackFunction:c}})});const a=exports.customizations_contractCategory_alias,r=exports.customizations_contractCategory_aliasPlural;let s=exports.contractCategories;const n=document.querySelector("#filters--contractCategory"),i=()=>{const t=n.value;let e=!1;n.innerHTML='<option value="">(All Available '+cityssm.escapeHTML(r)+")</option>";for(const o of s){const c=document.createElement("option");c.value=o,c.textContent=o,n.append(c),t===o&&(c.selected=!0,e=!0)}""===t||e||p()},l=()=>{cityssm.postJSON(t+"/contracts/doGetContractCategories",{},t=>{s=t.contractCategories,exports.contractCategories=t.contractCategories,i()})};i();const d=exports.dateDiff,u=document.querySelector("#form--filters"),m=u.querySelector("#filters--includeExpired"),y=document.querySelector("#container--results"),p=()=>{const e=new Date,c=cityssm.dateToString(e);y.innerHTML='<div class="has-text-centered p-4"><span class="icon"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i></span></div>',cityssm.postJSON(t+"/contracts/doGetContracts",u,t=>{if(0===t.contracts.length)return void(y.innerHTML='<div class="message is-info"><p class="message-body">There are no contracts available.</p></div>');const o=document.createElement("div");o.className="panel";for(const a of t.contracts){const t=document.createElement("a");t.className="panel-block is-block",a.endDate&&a.endDateString<c&&t.classList.add("has-background-danger-light"),t.dataset.contractId=a.contractId.toString(),t.href="#",t.addEventListener("click",g),t.innerHTML='<div class="columns is-multiline is-mobile"><div class="column is-12-mobile is-8-tablet"><h2 class="title is-5 mb-1">'+cityssm.escapeHTML(a.contractTitle)+"</h2>"+(""!==a.contractCategory?'<span class="icon"><i class="fas fa-archive" aria-hidden="true"></i></span> '+cityssm.escapeHTML(a.contractCategory)+"<br />":"")+(""!==a.contractParty?'<span class="icon"><i class="fas fa-user-tie" aria-hidden="true"></i></span> '+cityssm.escapeHTML(a.contractParty)+"<br />":"")+'</div><div class="column is-6-mobile has-text-centered"><i class="fas fa-play'+(a.startDateString<=c?" has-text-success":"")+'" aria-hidden="true"></i><br />'+a.startDateString+(a.startDateString<=c?'<br /><span class="is-size-7">'+d(cityssm.dateStringToDate(a.startDateString),e).formatted+" ago":"")+'</div><div class="column is-6-mobile has-text-centered"><i class="fas fa-stop" aria-hidden="true"></i><br />'+(a.endDate?a.endDateString:'<span class="has-text-grey">No End Date</span>')+(a.extensionDate?'<br /><span class="is-size-7">Extend to '+a.extensionDateString+"</span>":"")+"</div></div>",o.append(t)}y.innerHTML="",y.append(o)}),o("csv"),o("ical")},g=e=>{e.preventDefault();const o=e.currentTarget.dataset.contractId;cityssm.openHtmlModal("contractView",{onshow:t=>{const e=t.querySelectorAll("[data-customization='contractCategory.alias']");for(const t of e)t.textContent=a},onshown:(e,c)=>{if(bulmaJS.toggleHtmlClipped(),cityssm.postJSON(t+"/contracts/doGetContract",{contractId:o},t=>{const o=t.contract;if(!o||!o.contractId)return c(),cityssm.alertModal("Contract Not Found","Please try again.","OK","danger"),void p();e.querySelector("#contractEdit--contractId").value=o.contractId.toString(),e.querySelector("#contractEdit--contractTitle").value=o.contractTitle,e.querySelector("#contractEdit--contractCategory").value=o.contractCategory,e.querySelector("#contractEdit--contractParty").value=o.contractParty,e.querySelector("#contractEdit--contractDescription").value=o.contractDescription,e.querySelector("#contractEdit--startDateString").value=o.startDateString,e.querySelector("#contractEdit--endDateString").value=o.endDateString,e.querySelector("#contractEdit--extensionDateString").value=o.extensionDateString}),v){const t=e.querySelector("#button--switchToEditMode");t.classList.remove("is-hidden"),t.addEventListener("click",()=>{S(c)})}},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})};u.addEventListener("submit",t=>{t.preventDefault()}),n.addEventListener("change",p),document.querySelector("#filters--searchString").addEventListener("change",p),m.addEventListener("change",p),p();const v=exports.canUpdate;if(!v)return;document.querySelector("#button--addContract").addEventListener("click",()=>{let e,o;const c=c=>{c.preventDefault(),cityssm.postJSON(t+"/contracts/doAddContract",o,t=>{t.success?(e(),"1"===o.querySelector("#contractAdd--contractCategoryIsNew").value&&l(),p()):cityssm.alertModal("Error Adding Contract","Please try again","OK","danger")})};cityssm.openHtmlModal("contractAdd",{onshow:t=>{const e=t.querySelectorAll("[data-customization='contractCategory.alias']");for(const t of e)t.textContent=a;const o=t.querySelector("#contractAdd--contactCategory-existing");for(const t of s){const e=document.createElement("option");e.textContent=t,e.value=t,o.append(e)}},onshown:(t,a)=>{bulmaJS.toggleHtmlClipped(),e=a,(o=t.querySelector("form")).addEventListener("submit",c);const r=t.querySelector("#contractAdd--contractCategoryIsNew");r.addEventListener("change",()=>{"1"===r.value?(t.querySelector("#field--contractAdd--contractCategory-existing").classList.add("is-hidden"),t.querySelector("#field--contractAdd--contractCategory-new").classList.remove("is-hidden")):(t.querySelector("#field--contractAdd--contractCategory-new").classList.add("is-hidden"),t.querySelector("#field--contractAdd--contractCategory-existing").classList.remove("is-hidden"))})},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})});const S=e=>{bulmaJS.init();const o=document.querySelector("#form--contractEdit");o.querySelector("fieldset").disabled=!1,o.addEventListener("submit",c=>{c.preventDefault(),cityssm.postJSON(t+"/contracts/doUpdateContract",o,t=>{t.success&&(e(),p())})});const c=o.closest(".modal");c.querySelector("#button--switchToEditMode").remove(),c.querySelector("button[type='submit']").classList.remove("is-hidden"),c.querySelector("#contractEdit--optionsButton").classList.remove("is-hidden");const a=()=>{const c=o.querySelector("#contractEdit--contractId").value;cityssm.postJSON(t+"/contracts/doRemoveContract",{contractId:c},t=>{t.success&&(e(),l(),p())})};c.querySelector("#contractEdit--removeContractButton").addEventListener("click",t=>{t.preventDefault(),bulmaJS.confirm({message:"Are you sure you want to remove this contract record?",okButton:{text:"Yes, Remove the Contract",callbackFunction:a}})})}})();