"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const t=exports.urlPrefix,e=exports.customizations_contractCategory_alias,c=exports.customizations_contractCategory_aliasPlural;let a=exports.contractCategories;const o=document.querySelector("#filters--contractCategory"),r=()=>{const t=o.value;o.innerHTML='<option value="">(All Available '+cityssm.escapeHTML(c)+")</option>";for(const e of a){const c=document.createElement("option");c.value=e,c.textContent=e,o.append(c),t===e&&(c.selected=!0)}};r();const n=exports.dateDiff,s=document.querySelector("#form--filters"),i=document.querySelector("#container--results"),d=()=>{const e=new Date,c=cityssm.dateToString(e);i.innerHTML='<div class="has-text-centered p-4"><span class="icon"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i></span></div>',cityssm.postJSON(t+"/contracts/doGetContracts",s,t=>{if(0===t.contracts.length)return void(i.innerHTML='<div class="message is-info"><p class="message-body">There are no contracts available.</p></div>');const a=document.createElement("div");a.className="panel";for(const o of t.contracts){const t=document.createElement("a");t.className="panel-block is-block",t.dataset.contractId=o.contractId.toString(),t.href="#",t.addEventListener("click",l),t.innerHTML='<div class="columns is-multiline is-mobile"><div class="column is-12-mobile is-8-tablet"><h2 class="title is-5 mb-1">'+cityssm.escapeHTML(o.contractTitle)+"</h2>"+(""!==o.contractCategory?'<span class="icon"><i class="fas fa-archive" aria-hidden="true"></i></span> '+cityssm.escapeHTML(o.contractCategory)+"<br />":"")+(""!==o.contractParty?'<span class="icon"><i class="fas fa-user-tie" aria-hidden="true"></i></span> '+cityssm.escapeHTML(o.contractParty)+"<br />":"")+'</div><div class="column is-6-mobile has-text-centered"><i class="fas fa-play'+(o.startDateString<=c?" has-text-success":"")+'" aria-hidden="true"></i><br />'+o.startDateString+(o.startDateString<=c?'<br /><span class="is-size-7">'+n(cityssm.dateStringToDate(o.startDateString),e).formatted+" ago":"")+'</div><div class="column is-6-mobile has-text-centered"><i class="fas fa-stop" aria-hidden="true"></i><br />'+(o.endDate?o.endDateString:'<span class="has-text-grey">No End Date</span>')+(o.extensionDate?'<br /><span class="is-size-7">Extend to '+o.extensionDateString+"</span>":"")+"</div></div>",a.append(t)}i.innerHTML="",i.append(a)})},l=c=>{c.preventDefault();const a=c.currentTarget.dataset.contractId;cityssm.openHtmlModal("contractView",{onshow:t=>{const c=t.querySelectorAll("[data-customization='contractCategory.alias']");for(const t of c)t.textContent=e},onshown:(e,c)=>{if(bulmaJS.toggleHtmlClipped(),cityssm.postJSON(t+"/contracts/doGetContract",{contractId:a},t=>{const a=t.contract;if(!a||!a.contractId)return c(),cityssm.alertModal("Contract Not Found","Please try again.","OK","danger"),void d();e.querySelector("#contractEdit--contractId").value=a.contractId.toString(),e.querySelector("#contractEdit--contractTitle").value=a.contractTitle,e.querySelector("#contractEdit--contractCategory").value=a.contractCategory,e.querySelector("#contractEdit--contractParty").value=a.contractParty,e.querySelector("#contractEdit--contractDescription").value=a.contractDescription,e.querySelector("#contractEdit--startDateString").value=a.startDateString,e.querySelector("#contractEdit--endDateString").value=a.endDateString,e.querySelector("#contractEdit--extensionDateString").value=a.extensionDateString}),u){const t=e.querySelector("#button--switchToEditMode");t.classList.remove("is-hidden"),t.addEventListener("click",()=>{m(c)})}},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})};s.addEventListener("submit",t=>{t.preventDefault()}),o.addEventListener("change",d),document.querySelector("#filters--searchString").addEventListener("change",d),document.querySelector("#filters--includeExpired").addEventListener("change",d),d();const u=exports.canUpdate;if(!u)return;document.querySelector("#button--addContract").addEventListener("click",()=>{let c,o;const n=e=>{e.preventDefault(),cityssm.postJSON(t+"/contracts/doAddContract",o,e=>{e.success?(c(),"1"===o.querySelector("#contractAdd--contractCategoryIsNew").value&&cityssm.postJSON(t+"/contracts/doGetContractCategories",{},t=>{a=t.contractCategories,r()}),d()):cityssm.alertModal("Error Adding Contract","Please try again","OK","danger")})};cityssm.openHtmlModal("contractAdd",{onshow:t=>{const c=t.querySelectorAll("[data-customization='contractCategory.alias']");for(const t of c)t.textContent=e;const o=t.querySelector("#contractAdd--contactCategory-existing");for(const t of a){const e=document.createElement("option");e.textContent=t,e.value=t,o.append(e)}},onshown:(t,e)=>{bulmaJS.toggleHtmlClipped(),c=e,(o=t.querySelector("form")).addEventListener("submit",n);const a=t.querySelector("#contractAdd--contractCategoryIsNew");a.addEventListener("change",()=>{"1"===a.value?(t.querySelector("#field--contractAdd--contractCategory-existing").classList.add("is-hidden"),t.querySelector("#field--contractAdd--contractCategory-new").classList.remove("is-hidden")):(t.querySelector("#field--contractAdd--contractCategory-new").classList.add("is-hidden"),t.querySelector("#field--contractAdd--contractCategory-existing").classList.remove("is-hidden"))})},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})});const m=e=>{bulmaJS.init();const c=document.querySelector("#form--contractEdit");c.querySelector("fieldset").disabled=!1,c.addEventListener("submit",a=>{a.preventDefault(),cityssm.postJSON(t+"/contracts/doUpdateContract",c,t=>{t.success&&(e(),d())})});const a=c.closest(".modal");a.querySelector("#button--switchToEditMode").remove(),a.querySelector("button[type='submit']").classList.remove("is-hidden"),a.querySelector("#contractEdit--optionsButton").classList.remove("is-hidden");const o=()=>{const a=c.querySelector("#contractEdit--contractId").value;cityssm.postJSON(t+"/contracts/doRemoveContract",{contractId:a},t=>{t.success&&(e(),d())})};a.querySelector("#contractEdit--removeContractButton").addEventListener("click",t=>{t.preventDefault(),bulmaJS.confirm({message:"Are you sure you want to remove this contract record?",okButton:{text:"Yes, Remove the Contract",callbackFunction:o}})})}})();