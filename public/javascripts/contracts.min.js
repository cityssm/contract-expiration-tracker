"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const t=exports.urlPrefix,e=exports.canUpdate,a=document.querySelector("#filters--contractCategory"),o=document.querySelector("#filters--managingUserName"),c={csv:document.querySelector("#export--csv"),ical:document.querySelector("#export--ical"),"feed/atom":document.querySelector("#export--atom"),"feed/rss2":document.querySelector("#export--rss")},s=e=>{const s=window.location.protocol+"//"+window.location.host+t+"/export/"+e+"/"+exports.userName+"/"+exports.guidA+"/"+exports.guidB,r=new URL(s);""!==a.value&&r.searchParams.set("contractCategory",a.value),r.searchParams.set("searchString",document.querySelector("#filters--searchString").value),""!==o.value&&r.searchParams.set("managingUserName",o.value),h.checked&&r.searchParams.set("includeExpired",h.value),c[e].href=r.href},r=()=>{s("csv"),s("ical"),s("feed/rss2"),s("feed/atom")},n=()=>{cityssm.postJSON(t+"/contracts/doResetUserAccessGUIDs",{},t=>{t.success&&(bulmaJS.alert({title:"Export Keys Reset Successfully",message:"Note that if your export links are used by any application like Microsoft Excel or Outlook, you will have to update those links."}),exports.guidA=t.guidA,exports.guidB=t.guidB,r())})};document.querySelector("#navbar--resetUserAccessGUIDs").addEventListener("click",t=>{t.preventDefault(),bulmaJS.confirm({contextualColorName:"warning",title:"Are you sure you want to reset your export keys?",message:"This should definitely be done if you think your export keys have been compromised.",okButton:{text:"Yes, Reset the Keys",callbackFunction:n}})});const i=exports.customizations_contract_alias,l=exports.customizations_contract_aliasPlural,d=exports.customizations_contractCategory_alias,u=exports.customizations_contractCategory_aliasPlural,m=exports.customizations_contractParty_alias,p=t=>{const e=t.querySelectorAll("[data-customization='contract.alias']");for(const t of e)t.textContent=i;const a=t.querySelectorAll("[data-customization='contractCategory.alias']");for(const t of a)t.textContent=d;const o=t.querySelectorAll("[data-customization='contractParty.alias']");for(const t of o)t.textContent=m};let y=exports.contractCategories;const g=()=>{const t=a.value;let e=!1;a.innerHTML='<option value="">(All Available '+cityssm.escapeHTML(u)+")</option>";for(const o of y){const c=document.createElement("option");c.value=o,c.textContent=o,a.append(c),t===o&&(c.selected=!0,e=!0)}""===t||e||C()},v=()=>{cityssm.postJSON(t+"/contracts/doGetContractCategories",{},t=>{y=t.contractCategories,exports.contractCategories=t.contractCategories,g()})};g();const f=exports.dateDiff,S=document.querySelector("#form--filters"),h=S.querySelector("#filters--includeExpired"),x=document.querySelector("#container--results"),C=()=>{const e=new Date,a=cityssm.dateToString(e);x.innerHTML='<div class="has-text-centered p-4"><span class="icon"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i></span></div>',cityssm.postJSON(t+"/contracts/doGetContracts",S,t=>{if(0===t.contracts.length)return void(x.innerHTML='<div class="message is-info"><p class="message-body">There are no '+l.toLowerCase()+" available.</p></div>");const o=document.createElement("div");o.className="panel";for(const c of t.contracts){const t=document.createElement("a");t.className="panel-block is-block",c.endDate&&c.endDateString<a&&t.classList.add("has-background-danger-light"),t.dataset.contractId=c.contractId.toString(),t.href="#",t.addEventListener("click",q),t.innerHTML='<div class="columns is-multiline is-mobile"><div class="column is-12-mobile is-8-tablet"><h2 class="title is-5 mb-1">'+cityssm.escapeHTML(c.contractTitle)+'</h2><div class="columns is-mobile"><div class="column">'+(c.hasBeenReplaced?'<span class="icon"><i class="fas fa-fast-forward" aria-hidden="true"></i></span> Replaced<br />':"")+(""!==c.contractCategory?'<span class="icon"><i class="fas fa-archive" aria-hidden="true"></i></span> '+cityssm.escapeHTML(c.contractCategory)+"<br />":"")+(""!==c.contractParty?'<span class="icon"><i class="fas fa-user-tie" aria-hidden="true"></i></span> '+cityssm.escapeHTML(c.contractParty)+"<br />":"")+"</div>"+(c.managingUserName&&""!==c.managingUserName?'<div class="column is-4"><span class="icon"><i class="fas fa-id-card" aria-hidden="true"></i></span> '+cityssm.escapeHTML(c.managingUserName)+"</div>":"")+'</div></div><div class="column is-6-mobile has-text-centered"><i class="fas fa-play'+(c.startDateString<=a?" has-text-success":"")+'" aria-hidden="true"></i><br />'+c.startDateString+(c.startDateString<=a?'<br /><span class="is-size-7">'+f(cityssm.dateStringToDate(c.startDateString),e).formatted+" ago":"")+'</div><div class="column is-6-mobile has-text-centered"><i class="fas fa-stop" aria-hidden="true"></i><br />'+(c.endDate?c.endDateString:'<span class="has-text-grey">No End Date</span>')+(c.extensionDate?'<br /><span class="is-size-7">Extend to '+c.extensionDateString+"</span>":"")+"</div></div>",o.append(t)}x.innerHTML="",x.append(o)}),r()},q=a=>{a.preventDefault();const o=a.currentTarget.dataset.contractId;cityssm.openHtmlModal("contractView",{onshow:t=>{p(t),e&&t.querySelector("#contractEdit--privateContractDescription").closest(".field").classList.remove("is-hidden")},onshown:(a,c)=>{if(bulmaJS.toggleHtmlClipped(),cityssm.postJSON(t+"/contracts/doGetContract",{contractId:o},t=>{const o=t.contract;if(!o||!o.contractId)return c(),cityssm.alertModal(i+" Not Found","Please try again.","OK","danger"),void C();a.querySelector("#contractEdit--contractId").value=o.contractId.toString(),a.querySelector("#contractEdit--contractTitle").value=o.contractTitle,a.querySelector("#contractEdit--contractCategory").value=o.contractCategory,a.querySelector("#contractEdit--contractParty").value=o.contractParty,o.hasBeenReplaced&&(a.querySelector("#contractEdit--hasBeenReplaced").checked=!0);const s=a.querySelector("#contractEdit--managingUserName");let r=!1;if(e)for(const t of exports.canUpdateUserNames){const e=document.createElement("option");e.textContent=t,e.value=t,s.append(e),o.managingUserName&&o.managingUserName===t&&(e.selected=!0,r=!0)}if(o.managingUserName&&""!==o.managingUserName&&!r){const t=document.createElement("option");t.textContent=o.managingUserName,t.value=o.managingUserName,s.append(t),t.selected=!0}a.querySelector("#contractEdit--contractDescription").value=o.contractDescription,e&&(a.querySelector("#contractEdit--privateContractDescription").value=o.privateContractDescription),a.querySelector("#contractEdit--startDateString").value=o.startDateString,a.querySelector("#contractEdit--endDateString").value=o.endDateString,a.querySelector("#contractEdit--extensionDateString").value=o.extensionDateString}),e){const t=a.querySelector("#button--switchToEditMode");t.classList.remove("is-hidden"),t.addEventListener("click",()=>{E(c)})}},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})};if(S.addEventListener("submit",t=>{t.preventDefault()}),a.addEventListener("change",C),document.querySelector("#filters--searchString").addEventListener("change",C),h.addEventListener("change",C),o.addEventListener("change",C),C(),!e)return;document.querySelector("#button--addContract").addEventListener("click",()=>{let e,a;const o=o=>{o.preventDefault(),cityssm.postJSON(t+"/contracts/doAddContract",a,t=>{t.success?(e(),"1"===a.querySelector("#contractAdd--contractCategoryIsNew").value&&v(),C()):cityssm.alertModal("Error Adding "+i,"Please try again","OK","danger")})};cityssm.openHtmlModal("contractAdd",{onshow:t=>{p(t);const e=t.querySelector("#contractAdd--contactCategory-existing");for(const t of y){const a=document.createElement("option");a.textContent=t,a.value=t,e.append(a)}const a=t.querySelector("#contractAdd--managingUserName");for(const t of exports.canUpdateUserNames){const e=document.createElement("option");e.textContent=t,e.value=t,a.append(e),t===exports.userName&&(e.selected=!0)}},onshown:(t,c)=>{bulmaJS.toggleHtmlClipped(),e=c,(a=t.querySelector("form")).addEventListener("submit",o);const s=t.querySelector("#contractAdd--contractCategoryIsNew");s.addEventListener("change",()=>{"1"===s.value?(t.querySelector("#field--contractAdd--contractCategory-existing").classList.add("is-hidden"),t.querySelector("#field--contractAdd--contractCategory-new").classList.remove("is-hidden")):(t.querySelector("#field--contractAdd--contractCategory-new").classList.add("is-hidden"),t.querySelector("#field--contractAdd--contractCategory-existing").classList.remove("is-hidden"))})},onremoved:()=>{bulmaJS.toggleHtmlClipped()}})});const E=e=>{bulmaJS.init();const a=document.querySelector("#form--contractEdit");a.querySelector("fieldset").disabled=!1,a.addEventListener("submit",o=>{o.preventDefault(),cityssm.postJSON(t+"/contracts/doUpdateContract",a,t=>{t.success&&(e(),C())})});const o=a.closest(".modal");o.querySelector("#button--switchToEditMode").remove(),o.querySelector("button[type='submit']").classList.remove("is-hidden"),o.querySelector("#contractEdit--optionsButton").classList.remove("is-hidden");const c=()=>{const o=a.querySelector("#contractEdit--contractId").value;cityssm.postJSON(t+"/contracts/doRemoveContract",{contractId:o},t=>{t.success&&(e(),v(),C())})};o.querySelector("#contractEdit--removeContractButton").addEventListener("click",t=>{t.preventDefault(),bulmaJS.confirm({message:"Are you sure you want to remove this contract record?",okButton:{text:"Yes, Remove the Contract",callbackFunction:c}})})}})();