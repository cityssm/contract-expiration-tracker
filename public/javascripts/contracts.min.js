"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const t=exports.urlPrefix,e=exports.dateDiff,a=document.querySelector("#form--filters"),s=document.querySelector("#container--results"),c=()=>{const c=new Date,n=cityssm.dateToString(c);s.innerHTML='<div class="has-text-centered p-4"><span class="icon"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i></span></div>',cityssm.postJSON(t+"/contracts/doGetContracts",a,t=>{if(0===t.contracts.length)return void(s.innerHTML='<div class="message is-info"><p class="message-body">There are no contracts available.</p></div>');const a=document.createElement("div");a.className="panel";for(const s of t.contracts){const t=document.createElement("a");t.className="panel-block is-block",t.dataset.contractId=s.contractId.toString(),t.href="#",t.addEventListener("click",r),t.innerHTML='<div class="columns is-multiline is-mobile"><div class="column is-12-mobile is-8-tablet"><h2 class="title is-5 mb-1">'+cityssm.escapeHTML(s.contractTitle)+"</h2>"+(""!==s.contractCategory?'<span class="icon"><i class="fas fa-archive" aria-hidden="true"></i></span> '+cityssm.escapeHTML(s.contractCategory)+"<br />":"")+(""!==s.contractParty?'<span class="icon"><i class="fas fa-user-tie" aria-hidden="true"></i></span> '+cityssm.escapeHTML(s.contractParty)+"<br />":"")+'</div><div class="column is-6-mobile has-text-centered"><i class="fas fa-play'+(s.startDateString<=n?" has-text-success":"")+'" aria-hidden="true"></i><br />'+s.startDateString+(s.startDateString<=n?'<br /><span class="is-size-7">'+e(cityssm.dateStringToDate(s.startDateString),c).formatted+" ago":"")+'</div><div class="column is-6-mobile has-text-centered"><i class="fas fa-stop" aria-hidden="true"></i><br />'+(s.endDate?s.endDateString:'<span class="has-text-grey">No End Date</span>')+(s.extensionDate?'<br /><span class="is-size-7">Extend to '+s.extensionDateString+"</span>":"")+"</div></div>",a.append(t)}s.innerHTML="",s.append(a)})},r=e=>{e.preventDefault();const a=e.currentTarget.dataset.contractId;cityssm.openHtmlModal("contractView",{onshown:(e,s)=>{cityssm.postJSON(t+"/contracts/doGetContract",{contractId:a},t=>{if(!t||!t.contractId)return s(),cityssm.alertModal("Contract Not Found","Please try again.","OK","danger"),void c();e.querySelector("#contractEdit--contractId").value=t.contractId.toString(),e.querySelector("#contractEdit--contractTitle").value=t.contractTitle,e.querySelector("#contractEdit--contractCategory-new").value=t.contractCategory})}})};a.addEventListener("submit",t=>{t.preventDefault()}),document.querySelector("#filters--searchString").addEventListener("change",c),document.querySelector("#filters--includeExpired").addEventListener("change",c),c(),exports.canUpdate&&document.querySelector("#button--addContract").addEventListener("click",()=>{let e,a;const s=s=>{s.preventDefault(),cityssm.postJSON(t+"/contracts/doAddContract",a,t=>{t.success?(e(),c()):cityssm.alertModal("Error Adding Contract","Please try again","OK","danger")})};cityssm.openHtmlModal("contractAdd",{onshow:t=>{const e=exports.customizations_contractCategory_alias,a=t.querySelectorAll("[data-customization='contractCategory.alias']");for(const t of a)t.textContent=e},onshown:(t,c)=>{e=c,(a=t.querySelector("form")).addEventListener("submit",s);const r=t.querySelector("#contractAdd--contractCategoryIsNew");r.addEventListener("change",()=>{"1"===r.value?(t.querySelector("#field--contractAdd--contractCategory-existing").classList.add("is-hidden"),t.querySelector("#field--contractAdd--contractCategory-new").classList.remove("is-hidden")):(t.querySelector("#field--contractAdd--contractCategory-new").classList.add("is-hidden"),t.querySelector("#field--contractAdd--contractCategory-existing").classList.remove("is-hidden"))})}})})})();